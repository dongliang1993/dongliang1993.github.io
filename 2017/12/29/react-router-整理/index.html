<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="react-router 整理"/>













  <link rel="alternate" href="/default" title="我是你豆子欧巴">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.6.0" />



<link rel="canonical" href="http://yoursite.com/2017/12/29/react-router-整理/"/>


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.6.0" />






  



  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>









    <title> react-router 整理 - 我是你豆子欧巴 </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">我是你豆子欧巴</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            首页
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            归档
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">我是你豆子欧巴</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              归档
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          react-router 整理
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-12-29
        </span>
        
        
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装-React-Router"><span class="toc-text"><a href="#&#x5B89;&#x88C5;-React-Router" class="headerlink" title="&#x5B89;&#x88C5; React Router"></a>&#x5B89;&#x88C5; React Router</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#React-Router-基础"><span class="toc-text"><a href="#React-Router-&#x57FA;&#x7840;" class="headerlink" title="React Router &#x57FA;&#x7840;"></a>React Router &#x57FA;&#x7840;</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Router"><span class="toc-text"><a href="#Router" class="headerlink" title="Router"></a>Router</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用-组件包裹-App-组件。"><span class="toc-text"><a href="#&#x4F7F;&#x7528;-&#x7EC4;&#x4EF6;&#x5305;&#x88F9;-App-&#x7EC4;&#x4EF6;&#x3002;" class="headerlink" title="&#x4F7F;&#x7528;  &#x7EC4;&#x4EF6;&#x5305;&#x88F9; App &#x7EC4;&#x4EF6;&#x3002;"></a>&#x4F7F;&#x7528; <browserrouter> &#x7EC4;&#x4EF6;&#x5305;&#x88F9; App &#x7EC4;&#x4EF6;&#x3002;</browserrouter></span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#history"><span class="toc-text"><a href="#history" class="headerlink" title="history"></a>history</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Links-and-Routes"><span class="toc-text"><a href="#Links-and-Routes" class="headerlink" title="Links and Routes"></a>Links and Routes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#嵌套路由"><span class="toc-text"><a href="#&#x5D4C;&#x5957;&#x8DEF;&#x7531;" class="headerlink" title="&#x5D4C;&#x5957;&#x8DEF;&#x7531;"></a>&#x5D4C;&#x5957;&#x8DEF;&#x7531;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Path-and-match"><span class="toc-text"><a href="#Path-and-match" class="headerlink" title="Path and match"></a>Path and match</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Switch-组件"><span class="toc-text"><a href="#Switch-&#x7EC4;&#x4EF6;" class="headerlink" title="Switch &#x7EC4;&#x4EF6;"></a>Switch &#x7EC4;&#x4EF6;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Demo-2-嵌套路由"><span class="toc-text"><a href="#Demo-2-&#x5D4C;&#x5957;&#x8DEF;&#x7531;" class="headerlink" title="Demo 2: &#x5D4C;&#x5957;&#x8DEF;&#x7531;"></a>Demo 2: &#x5D4C;&#x5957;&#x8DEF;&#x7531;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#保护式路由"><span class="toc-text"><a href="#&#x4FDD;&#x62A4;&#x5F0F;&#x8DEF;&#x7531;" class="headerlink" title="&#x4FDD;&#x62A4;&#x5F0F;&#x8DEF;&#x7531;"></a>&#x4FDD;&#x62A4;&#x5F0F;&#x8DEF;&#x7531;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#重定向"><span class="toc-text"><a href="#&#x91CD;&#x5B9A;&#x5411;" class="headerlink" title="&#x91CD;&#x5B9A;&#x5411;"></a>&#x91CD;&#x5B9A;&#x5411;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义路由"><span class="toc-text"><a href="#&#x81EA;&#x5B9A;&#x4E49;&#x8DEF;&#x7531;" class="headerlink" title="&#x81EA;&#x5B9A;&#x4E49;&#x8DEF;&#x7531;"></a>&#x81EA;&#x5B9A;&#x4E49;&#x8DEF;&#x7531;</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-text"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</span></a></li></ol>
    </div>
  </div>


    <div class="post-content">
      
        <p>原文 <a href="http://www.zcfy.cc/article/react-router-v4-the-complete-guide-mdash-sitepoint-4448.html" target="_blank" rel="noopener">http://www.zcfy.cc/article/react-router-v4-the-complete-guide-mdash-sitepoint-4448.html</a></p>
<a id="more"></a>
<h2 id="安装-React-Router"><a href="#安装-React-Router" class="headerlink" title="安装 React Router"></a>安装 React Router</h2><p>React Router 库包含三个包：react-router, react-router-dom, 和 react-router-native。react-router 是路由的核心包，而其他两个是基于特定环境的。如果你在开发一个网站，你应该使用 react-router-dom，如果你在移动应用的开发环境使用 React Native，你应该使用 react-router-native。</p>
<p>使用 npm 安装 react-router-dom：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save react-router-dom</span><br></pre></td></tr></table></figure></p>
<h2 id="React-Router-基础"><a href="#React-Router-基础" class="headerlink" title="React Router 基础"></a>React Router 基础</h2><p>下面是路由的例子：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Router&gt;</span><br><span class="line">  &lt;Route exact path=<span class="string">"/"</span> component=&#123;Home&#125;/&gt;</span><br><span class="line">  &lt;Route path=<span class="string">"/category"</span> component=&#123;Category&#125;/&gt;</span><br><span class="line">  &lt;Route path=<span class="string">"/login"</span> component=&#123;Login&#125;/&gt;</span><br><span class="line">  &lt;Route path=<span class="string">"/products"</span> component=&#123;Products&#125;/&gt;</span><br><span class="line">&lt;<span class="regexp">/Router&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="Router"><a href="#Router" class="headerlink" title="Router"></a>Router</h3><p>像上面的例子，你需要一个 <router> 组件和一些 <route> 组件来创建一个基本的路由。由于我们创建的是一个基于浏览器的应用，我们可以从 React Router API 中使用这两种类型的路由：</route></router></p>
<ol>
<li><browserrouter></browserrouter></li>
<li><hashrouter><br>它们之间主要的区别，可以在它们所创建的 URL 明显看出：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;BrowserRouter&gt;</span></span><br><span class="line">http:<span class="comment">//example.com/about</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// &lt;HashRouter&gt;</span></span><br><span class="line">http:<span class="comment">//example.com/#/about</span></span><br></pre></td></tr></table></figure>
</hashrouter></li>
</ol>
<p><browserrouter> 在两者中更为常用，原因是它使用了 HTML5 的 history API 来记录你的路由历史。而 <hashrouter> 则使用 URL(window.location.hash) 的 hash 部分来记录。如果你想兼容老式浏览器，你应该使用 <hashrouter>。</hashrouter></hashrouter></browserrouter></p>
<h3 id="使用-组件包裹-App-组件。"><a href="#使用-组件包裹-App-组件。" class="headerlink" title="使用  组件包裹 App 组件。"></a>使用 <browserrouter> 组件包裹 App 组件。</browserrouter></h3><p>index.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Import statements */</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* App is the entry point to the React code.*/</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* import BrowserRouter from 'react-router-dom' */</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  BrowserRouter <span class="keyword">as</span> Router</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Router&gt;</span><br><span class="line">    &lt;App /&gt;</span><br><span class="line">  &lt;<span class="regexp">/Router&gt;,</span></span><br><span class="line"><span class="regexp">  document.getElementById('root')</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure></p>
<p>注意：</p>
<ol>
<li>Router 组件只能有一个子元素。子元素可以是 HTML - 例如 div - 也可以是一个 react 组件。</li>
<li><app> 其实是个根组件，组件想要根据对应的 url 来正确渲染必须要包裹在 Router 组件里面</app></li>
</ol>
<p>要让 React Router 工作，你需要从 react-router-dom 库引入相关的 API。这里，我在 index.js 引入了 BrowserRouter，也从 App.js 引入了 App 组件。App.js，如你所猜想的，是 React 组件的入口。</p>
<p>上述代码给我们整个 App 组件创建了一个 history 实例。接下来正式介绍下 history。</p>
<h3 id="history"><a href="#history" class="headerlink" title="history"></a>history</h3><p>history 是一个让你轻松管理所有 Javascript 运行的会话记录的 Javascript 库。history 提供了简洁的 API，让你可以管理 history 堆栈，跳转，确认跳转，以及保持会话之间的状态。 - 来自 React 培训文档</p>
<p>每个 router 组件创建了一个 history 对象，用来记录当前路径 (history.location)，上一步路径也存储在堆栈中。当前路径改变时，视图会重新渲染，给你一种跳转的感觉。当前路径又是如何改变的呢？history 对象有 history.push() 和 history.replace() 这些方法来实现。当你点击 <link> 组件会触发 history.push()，使用<redirect> 则会调用 history.replace()。其他方法 - 例如 history.goBack() 和 history.goForward() - 用来根据页面的后退和前进来跳转 history 堆栈。</redirect></p>
<p>接下来，我们谈谈 Links 和 Routes</p>
<h3 id="Links-and-Routes"><a href="#Links-and-Routes" class="headerlink" title="Links and Routes"></a>Links and Routes</h3><p><route> 是 React Router 里最重要的组件。若当前路径匹配 route 的路径，它会渲染对应的 UI。理想来说，<route> 应该有一个叫 path 的 prop，当路径名跟当前路径匹配才会渲染。</route></route></p>
<p>另一方面，<link> 用来跳转页面。可以类比 HTML 的锚元素。然而，使用锚链接会导致浏览器的刷新，这不是我们想要的。所以，我们可以使用<link> 来跳转至具体的 URL，并且视图重新渲染不会导致浏览器刷新。</p>
<p>我们已经介绍了创建一个基本的路由需要的所有东西。让我们试一个吧。</p>
<p>Demo 1: 基础路由</p>
<p>src/App.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Import statements */</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  Link,</span><br><span class="line">  Route,</span><br><span class="line">  Switch</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Home component */</span></span><br><span class="line"><span class="keyword">const</span> Home = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h2&gt;Home&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Category component */</span></span><br><span class="line"><span class="keyword">const</span> Category = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h2&gt;Category&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Products component */</span></span><br><span class="line"><span class="keyword">const</span> Products = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h2&gt;Products&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* App component */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;ul className=<span class="string">"nav navbar-nav"</span>&gt;</span><br><span class="line">          <span class="comment">// Link 组件通常被用来链接跳转到其他的页面</span></span><br><span class="line">          &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">"/"</span>&gt;</span>Homes<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">          &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">"/category"</span>&gt;</span>Category<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">          &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">"/products"</span>&gt;</span>Products<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">        &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">        &lt;hr /</span>&gt;</span><br><span class="line">        <span class="comment">// 如果 Route 组件的 path 属性和当前的 URL 匹配</span></span><br><span class="line">        <span class="comment">// 那么就会渲染对应的 component</span></span><br><span class="line">        <span class="comment">// 这里还有一些问题，下面会说到</span></span><br><span class="line">        &lt;Route path=<span class="string">"/"</span> component=&#123;Home&#125;/&gt;</span><br><span class="line">        &lt;Route path=<span class="string">"/category"</span> component=&#123;Category&#125;/&gt;</span><br><span class="line">        &lt;Route path=<span class="string">"/products"</span> component=&#123;Products&#125;/&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>我们在 App.js 里定义了 Home，Category，和 Products 组件。尽管目前看起来没问题，当组件变得越来越臃肿，最好将每个组件分成单独的文件。根据经验，如果组件代码超过了 10 行，我通常会给它创建一个新的文件。从第二个 demo 开始，我会将 App.js 里面越来越多的组件分成单独的文件。</p>
<p>在 App 组件中，我们写了路由跳转的逻辑。 <route> 的路径与当前路径匹配，对应组件就会被渲染。对应渲染的组件传给了第二个 prop–component。</route></p>
<p>在这里，/ 同时匹配 /, /category 和 /products, 因此，所有路由都匹配并被渲染。我们该如何避免呢？应该给 path=’/‘的路由传递 exact= {true}props：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route exact=&#123;<span class="literal">true</span>&#125; path=<span class="string">"/"</span> component=&#123;Home&#125;/&gt;</span><br></pre></td></tr></table></figure></p>
<p>若只想要路由在路径完全相同时渲染，你就可以使用 exact props。</p>
<h3 id="嵌套路由"><a href="#嵌套路由" class="headerlink" title="嵌套路由"></a>嵌套路由</h3><p>创建嵌套路由之前，我们需要更深入的理解 <route> 如何运行。开始吧。</route></p>
<p><route> 有三个可以用来定义要渲染内容的 props：</route></p>
<ol>
<li>component. 在上面我们已经看到了。当 URL 匹配时，router 会将传递的组件使用 React.createElement 来生成一个 React 元素。</li>
<li>render. 适合行内渲染。在当前路径匹配路由路径时，render prop 期望一个函数返回一个元素。</li>
<li>children. children prop 跟 render 很类似，也期望一个函数返回一个 React 元素。然而，不管路径是否匹配，children 都会渲染。</li>
</ol>
<h3 id="Path-and-match"><a href="#Path-and-match" class="headerlink" title="Path and match"></a>Path and match</h3><p>path 用来标识路由匹配的 URL 部分。React Router 使用了 Path-to-RegExp 库将路径字符串转为正则表达式。然后正则表达式会匹配当前路径。</p>
<p>当路由路径和当前路径成功匹配，会生成一个对象，我们叫它 match。match 对象有更多关于 URL 和 path 的信息。这些信息可以通过它的属性获取，如下所示：</p>
<ol>
<li>match.url. 返回 URL 匹配部分的字符串。对于创建嵌套的 <link>很有用。</li>
<li>match.path. 返回路由路径字符串 - 就是 <route path="">。将用来创建嵌套的<route>。</route></route></li>
<li>match.isExact. 返回布尔值，如果准确（没有任何多余字符）匹配则返回 true。</li>
<li>match.params. 返回一个对象包含 Path-to-RegExp 包从 URL 解析的键值对。</li>
</ol>
<p>现在我们完全了解了<route>，开始创建一个嵌套路由吧。</route></p>
<h3 id="Switch-组件"><a href="#Switch-组件" class="headerlink" title="Switch 组件"></a>Switch 组件</h3><p>在我们开始示例代码签，我想给你介绍下<switch>组件。当一起使用多个<route>时，所有匹配的 routes 都会被渲染。根据 demo1 的代码，我添加一个新的 route 来验证为什么 <switch> 很有用。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route exact path=<span class="string">"/"</span> component=&#123;Home&#125;/&gt;</span><br><span class="line">&lt;Route path=<span class="string">"/products"</span> component=&#123;Products&#125;/&gt;</span><br><span class="line">&lt;Route path=<span class="string">"/category"</span> component=&#123;Category&#125;/&gt;</span><br><span class="line">&lt;Route path=<span class="string">"/:id"</span> render = &#123;()=&gt; (<span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span> I want this text to show up for all routes other than '/', '/products' and '/category' <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>)&#125;/&gt;</span><br></pre></td></tr></table></figure></switch></route></switch></p>
<p>当 URL 为 /products，所有匹配 /products 路径的 route 都会被渲染。所以，那个 path 为：id 的 <route> 会跟着 Products 组件一块渲染。设计就是如此。但是，若这不是你想要的结果，你应该给你的 routes 添加 <switch> 组件。有 <switch> 组件的话，只有第一个匹配路径的子&lt; Route&gt; 会渲染。</switch></switch></route></p>
<h3 id="Demo-2-嵌套路由"><a href="#Demo-2-嵌套路由" class="headerlink" title="Demo 2: 嵌套路由"></a>Demo 2: 嵌套路由</h3><p>之前，我们给 /, /category and /products 创建了路由。但如果我们想要 /category/shoes 这种形式的 URL 呢？</p>
<p>不像 React Router 之前的版本，在版本 4 中，嵌套的 <route> 最好放在父元素里面。所以，Category 组件就是这里的父组件，我们将在父组件中定义 category/:name 路由。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Category.jsx</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  Link,</span><br><span class="line">  Route,</span><br><span class="line">  Switch</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Category = <span class="function">(<span class="params">&#123; match &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;ul&gt;</span><br><span class="line">        &lt;li&gt;</span><br><span class="line">          &lt;Link to=&#123;<span class="string">`<span class="subst">$&#123;match.url&#125;</span>/shoes`</span>&#125;&gt;Shoes&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>li&gt;</span><br><span class="line">        &lt;li&gt;</span><br><span class="line">          &lt;Link to=&#123;<span class="string">`<span class="subst">$&#123;match.url&#125;</span>/boots`</span>&#125;&gt;Boots&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>li&gt;</span><br><span class="line">        &lt;li&gt;</span><br><span class="line">          &lt;Link to=&#123;<span class="string">`<span class="subst">$&#123;match.url&#125;</span>/footwear`</span>&#125;&gt;Footwear&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>li&gt;</span><br><span class="line">      &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Route path=&#123;`$&#123;match.path&#125;/</span>:name<span class="string">`&#125; render= &#123;(&#123;match&#125;) =&gt;( &lt;div&gt; &lt;h3&gt; &#123;match.params.name&#125; &lt;/h3&gt;&lt;/div&gt;)&#125;/&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  )</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">export default Category;</span></span><br></pre></td></tr></table></figure></route></p>
<p>首先，我们给嵌套路由定义了一些 Link。之前提到过，match.url 用来构建嵌套链接，match.path 用来构建嵌套路由。如果你对 match 有不理解的概念，console.log(match) 会提供一些有用的信息来帮助你了解它。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=&#123;<span class="string">`<span class="subst">$&#123;match.path&#125;</span>/:name`</span>&#125;</span><br><span class="line">  render= &#123;(&#123;match&#125;) =&gt;( <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span> <span class="tag">&lt;<span class="name">h3</span>&gt;</span> &#123;match.params.name&#125; <span class="tag">&lt;/<span class="name">h3</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)&#125;/&gt;</span><br></pre></td></tr></table></figure></p>
<p>这是我们首次尝试动态路由。不同于硬编码路由，我们给 pathname 使用了变量。:name 是路径参数，获取 category/ 之后到下一条斜杠之间的所有内容。所以，类似 products/running-shoes 的路径名会生成如下的一个 params 对象：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  name: <span class="string">'running-shoes'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>参数可以通过 match.params 或 props.match.params 来获取，取决于传递哪种 props。另外有趣的是我们使用了 renderprop。render props 非常适合行内函数，这样不需要单独拆分组件。</p>
<p>Demo 3: 带 Path 参数的嵌套路由</p>
<p>我们让事情变得再复杂一些，可以吗？一个真实的路由应该是根据数据，然后动态展示。假设我们获取了从服务端 API 返回的 product 数据，如下所示。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Products.jsx</span></span><br><span class="line"><span class="keyword">const</span> productData = [</span><br><span class="line">  &#123;</span><br><span class="line">    id: <span class="number">1</span>,</span><br><span class="line">    name: <span class="string">'NIKE Liteforce Blue Sneakers'</span>,</span><br><span class="line">    description: <span class="string">'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin molestie.'</span>,</span><br><span class="line">    status: <span class="string">'Available'</span></span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id: <span class="number">2</span>,</span><br><span class="line">    name: <span class="string">'Stylised Flip Flops and Slippers'</span>,</span><br><span class="line">    description: <span class="string">'Mauris finibus, massa eu tempor volutpat, magna dolor euismod dolor.'</span>,</span><br><span class="line">    status: <span class="string">'Out of Stock'</span></span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id: <span class="number">3</span>,</span><br><span class="line">    name: <span class="string">'ADIDAS Adispree Running Shoes'</span>,</span><br><span class="line">    description: <span class="string">'Maecenas condimentum porttitor auctor. Maecenas viverra fringilla felis, eu pretium.'</span>,</span><br><span class="line">    status: <span class="string">'Available'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id: <span class="number">4</span>,</span><br><span class="line">    name: <span class="string">'ADIDAS Mid Sneakers'</span>,</span><br><span class="line">    description: <span class="string">'Ut hendrerit venenatis lacus, vel lacinia ipsum fermentum vel. Cras.'</span>,</span><br><span class="line">    status: <span class="string">'Out of Stock'</span></span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>我们需要根据下面这些路径创建路由：</p>
<ol>
<li>/products. 这个路径应该展示产品列表。</li>
<li>/products/:productId. 如果产品有 :productId，这个页面应该展示该产品的数据，如果没有，就该展示一个错误信息。<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">src/Products.jsx</span><br><span class="line"><span class="comment">/* Import statements have been left out for code brevity */</span></span><br><span class="line"><span class="keyword">const</span> Products = <span class="function">(<span class="params">&#123; match &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">const</span> productsData = [</span><br><span class="line">      &#123;</span><br><span class="line">          id: <span class="number">1</span>,</span><br><span class="line">          name: <span class="string">'NIKE Liteforce Blue Sneakers'</span>,</span><br><span class="line">          description: <span class="string">'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin molestie.'</span>,</span><br><span class="line">          status: <span class="string">'Available'</span></span><br><span class="line"></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">//Rest of the data has been left out for code brevity</span></span><br><span class="line">  ]</span><br><span class="line">  <span class="keyword">const</span> linkList = productsData.map(<span class="function"><span class="params">product</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;li&gt;</span><br><span class="line">        &lt;Link to=&#123;<span class="string">`<span class="subst">$&#123;match.url&#125;</span>/<span class="subst">$&#123;product.id&#125;</span>`</span>&#125;&gt;</span><br><span class="line">          &#123;product.name&#125;</span><br><span class="line">        &lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>li&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span>(</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h3&gt; Products&lt;<span class="regexp">/h3&gt;</span></span><br><span class="line"><span class="regexp">        &lt;ul&gt; &#123;linkList&#125; &lt;/u</span>l&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Route path=&#123;`$&#123;match.url&#125;/</span>:productId<span class="string">`&#125;</span></span><br><span class="line"><span class="string">          render=&#123; (props) =&gt; &lt;Product data= &#123;productsData&#125; &#123;...props&#125; /&gt;&#125;/&gt;</span></span><br><span class="line"><span class="string">      &lt;Route exact path=&#123;match.url&#125;</span></span><br><span class="line"><span class="string">          render=&#123;() =&gt; (</span></span><br><span class="line"><span class="string">          &lt;div&gt;Please select a product.&lt;/div&gt;</span></span><br><span class="line"><span class="string">          )&#125;</span></span><br><span class="line"><span class="string">      /&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  )</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>首先，我们通过 productsData.id 创建一列 <links>，并把它存储在 linkList。路由从路径字符串根据匹配的对应产品 id 获取参数。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=&#123;<span class="string">`<span class="subst">$&#123;match.url&#125;</span>/:productId`</span>&#125;</span><br><span class="line">  render=&#123; (props) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">Product</span> <span class="attr">data</span>= <span class="string">&#123;productsData&#125;</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span>&#125;/&gt;</span></span><br></pre></td></tr></table></figure></links></p>
<p>你可能期望使用 component = { Product } 来替代行内 render 函数。问题是，我们不仅需要 productsData，并顺带把剩余 prop 也传给 Product 组件。尽管你还有其他方法，不过我觉的这是最简单的方法了。{…props} 使用 ES6 的扩展运算符 将所有 prop 传给组件。</p>
<p>这是 Product 组件的代码。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Import statements have been left out for code brevity */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Product = <span class="function">(<span class="params">&#123;match, data&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> product= data.find(<span class="function"><span class="params">p</span> =&gt;</span> p.id == match.params.productId)</span><br><span class="line">  <span class="keyword">let</span> productData</span><br><span class="line">  <span class="keyword">if</span> (product) &#123;</span><br><span class="line">    productData = <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">h3</span>&gt;</span> &#123;product.name&#125; <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;product.description&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">h4</span>&gt;</span>&#123;product.status&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span></span><br><span class="line"><span class="xml">                  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    productData = <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span> Sorry. Product doesnt exist <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">         &#123;productData&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br></pre></td></tr></table></figure></p>
<p>find 方法用来查找数组中对象的 id 属性等于 match.params.productId。如果 product 存在，productData 就会展示，如果不存在，“Product 不存在”的信息就会被渲染。</p>
<h3 id="保护式路由"><a href="#保护式路由" class="headerlink" title="保护式路由"></a>保护式路由</h3><p>最后一个 demo，我们将围绕保护式路由的技术进行讨论。那么，如果有人想进入 /admin 页面，他们会被要求先登录。然而，在我们保护路由之前还需要考虑一些事情。</p>
<h3 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h3><p>类似服务端重定向，<redirect> 会将 history 堆栈的当前路径替换为新路径。新路径通过 toprop 传递。这是如何使用<redirect>：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Redirect to=&#123;&#123;<span class="attr">pathname</span>: <span class="string">'/login'</span>, <span class="attr">state</span>: &#123;<span class="attr">from</span>: props.location&#125;&#125;&#125;</span><br></pre></td></tr></table></figure></redirect></redirect></p>
<p>如果有人已经注销了账户，想进入 /admin 页面，他们会被重定向到 /login 页面。当前路径的信息是通过 state 传递的，若用户信息验证成功，用户会被重定向回初始路径。在子组件中，你可以通过 this.props.location.state 获取 state 的信息。</p>
<h3 id="自定义路由"><a href="#自定义路由" class="headerlink" title="自定义路由"></a>自定义路由</h3><p>自定义路由最适合描述组件里嵌套的路由。如果我们需要确定一个路由是否应该渲染，最好的方法是写个自定义组件。下面是通过其他路由来定义自定义路由。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/App.js</span></span><br><span class="line">&lt;Switch&gt;</span><br><span class="line">  &lt;Route exact path=<span class="string">"/"</span> component=&#123;Home&#125; data=&#123;data&#125;/&gt;</span><br><span class="line">  &lt;Route path=<span class="string">"/category"</span> component=&#123;Category&#125;/&gt;</span><br><span class="line">  &lt;Route path=<span class="string">"/login"</span> component=&#123;Login&#125;/&gt;</span><br><span class="line">  &lt;PrivateRoute authed=&#123;fakeAuth.isAuthenticated&#125; path=<span class="string">'/products'</span> component = &#123;Products&#125; /&gt;</span><br><span class="line">&lt;<span class="regexp">/Switch&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>若用户已登录，fakeAuth.isAuthenticated 返回 true，反之亦然。</p>
<p>这是 PrivateRoute 的定义。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/App.js</span></span><br><span class="line"><span class="keyword">const</span> PrivateRoute = <span class="function">(<span class="params">&#123;component: Component, authed, ...rest&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Route</span><br><span class="line">      &#123;...rest&#125;</span><br><span class="line">      render=&#123;(props) =&gt; authed === <span class="literal">true</span></span><br><span class="line">        ? <span class="xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span></span><br><span class="line">        : &lt;Redirect to=&#123;&#123;pathname: '/login', state: &#123;from: props.location&#125;&#125;&#125; /&gt;&#125; /&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如果用户已登录，路由将渲染 Admin 组件。否则，用户将重定义到 /login 登录页面。这样做的好处是，定义更明确，而且 PrivateRoute 可以复用。</p>
<p>最后，下面是 Login 组件的代码：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Redirect &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Login</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>()</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      redirectToReferrer: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  login = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    fakeAuth.authenticate(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123; <span class="attr">redirectToReferrer</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="keyword">from</span> &#125; = <span class="keyword">this</span>.props.location.state || &#123; <span class="attr">from</span>: &#123; <span class="attr">pathname</span>: <span class="string">'/'</span> &#125; &#125;</span><br><span class="line">    <span class="keyword">const</span> &#123; redirectToReferrer &#125; = <span class="keyword">this</span>.state</span><br><span class="line">    <span class="keyword">if</span> (redirectToReferrer) &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;Redirect to=&#123;<span class="keyword">from</span>&#125; /&gt;</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;p&gt;You must log <span class="keyword">in</span> to view the page at &#123;<span class="keyword">from</span>.pathname&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;this.login&#125;&gt;Log in&lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span>* A fake authentication <span class="function"><span class="keyword">function</span> */</span></span><br><span class="line"><span class="function"><span class="title">export</span> <span class="title">const</span> <span class="title">fakeAuth</span> = </span>&#123;</span><br><span class="line">  isAuthenticated: <span class="literal">false</span>,</span><br><span class="line">  authenticate(cb) &#123;</span><br><span class="line">    <span class="keyword">this</span>.isAuthenticated = <span class="literal">true</span></span><br><span class="line">     setTimeout(cb, <span class="number">100</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>如你在本文中所看到的，React Router是一个帮助React构建更完美，更声明式的路由库。不像React Router之前的版本，在v4中，一切就“只是组件”。而且，新的设计模式也更完美的使用React的构建方式来实现。</p>
<p>在本次教程中，我们学到了：</p>
<p>如何配置和安装React Router</p>
<p>基础版路由，和一些基础组件，例如<router>, <route>和<link></route></router></p>
<p>如何构建一个有导航功能的极简路由和嵌套路由</p>
<p>如何根据路径参数构建动态路由</p>
<p>最后，我们还学习了一些高级路由技巧，用来创建保护式路由的最终demo。</p>

      
    </div>

    
      
      

  <div class="post-copyright">
    <p class="copyright-item">
      <span>原文作者: </span>
      <a href="http://yoursite.com">我是你豆子欧巴</a>
    </p>
    <p class="copyright-item">
      <span>原文链接: </span>
      <a href="http://yoursite.com/2017/12/29/react-router-整理/">http://yoursite.com/2017/12/29/react-router-整理/</a>
    </p>
    <p class="copyright-item">
      <span>许可协议: </span>
      
      <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>
    </p>
  </div>



      
      
    

    
      <footer class="post-footer">
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2018/01/02/二分查找/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">二分查找</span>
        <span class="prev-text nav-mobile">上一篇</span>
      </a>
    
    
      <a class="next" href="/2017/12/20/面向对象的程序设计/">
        <span class="next-text nav-default">面向对象的程序设计</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
  </div>


        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:your@email.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
    
      
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>


<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://hexo.io/">Hexo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2015 - 
    
    2018

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">我是你豆子欧巴</span>
  </span>
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  



    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  


    <script type="text/javascript" src="/js/src/even.js?v=2.6.0"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.6.0"></script>

  </body>
</html>
